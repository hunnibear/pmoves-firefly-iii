{"version":3,"sources":["webpack:///src/components/transactions/Edit.vue","webpack:///./src/components/transactions/Edit.vue?f2c6","webpack:///./src/components/transactions/Edit.vue","webpack:///./src/components/transactions/Edit.vue?cacc","webpack:///./src/pages/transactions/edit.js"],"names":["name","created","this","groupId","parseInt","parts","length","getTransactionGroup","getAllowedOpposingTypes","getCustomFields","data","successMessage","errorMessage","transactions","originalTransactions","groupTitle","originalGroupTitle","transactionType","groupTitleErrors","customFields","returnedGroupId","returnedGroupTitle","date","Date","time","originalDate","originalTime","submittedTransaction","submittedLinks","submittedAttachments","allowedOpposingTypes","destinationAllowedTypes","sourceAllowedTypes","enableSubmit","createAnother","resetFormAfter","components","Alert","SplitPills","SplitForm","TransactionGroupTitle","methods","axios","get","parseTransactionGroup","attributes","group_title","hasOwnProperty","i","test","push","result","lodashClonedeep","parseLinks","transaction_journal_id","parseTransaction","index","array","type","charAt","toUpperCase","slice","source_type","destination_type","description","source_account_id","source_id","source_account_name","source_name","source_account_type","destination_account_id","destination_id","destination_account_name","destination_name","destination_account_type","amount","currency_id","foreign_amount","foreign_currency_id","category","category_name","budget_id","bill_id","tags","interest_date","substr","book_date","process_date","due_date","payment_date","invoice_date","internal_reference","external_url","external_uri","external_id","notes","location","zoom_level","longitude","latitude","errors","journalId","parseLink","opposingId","link","outward_id","linkDirection","promises","Promise","resolve","link_type_id","all","then","journals","journal","id","linkTypeId","direction","transaction_group_id","responses","currency_code","uploadedAttachment","console","log","payload","storeLocation","zoomLevel","lng","lat","storeAccountValue","storeDate","storeTime","storeField","field","value","removeTransaction","splice","storeGroupTitle","selectedAttachments","addTransaction","newTransaction","submitTransaction","submission","shouldSubmit","basicFields","ii","currentTransaction","fieldName","originalTransaction","diff","piggy_bank_id","JSON","stringify","shouldLinks","shouldUpload","theDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","dateStr","Object","keys","transactionCount","submitUpdate","submitTransactionLinks","compareLinks","compare","put","url","parseErrors","resetErrors","$t","message","key","transactionIndex","split","setTransactionError","deleteOriginalLinks","transaction","links","newLinks","originalLinks","inward_id","linkObject","currentLink","post","_vm","_h","$createElement","_c","_self","attrs","_v","staticClass","_l","on","$event","model","callback","$$v","$set","expression","_e","_s","directives","rawName","domProps","Array","isArray","_i","$$a","$$el","target","$$c","checked","$$i","concat","require","Vue","config","productionTip","i18n","props","store","render","createElement","Edit","beforeCreate","$store","commit","dispatch","$mount"],"mappings":"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","file":"/public/js/transactions/edit.js","sourcesContent":["<!--\n  - Edit.vue\n  - Copyright (c) 2021 james@firefly-iii.org\n  -\n  - This file is part of Firefly III (https://github.com/firefly-iii).\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <https://www.gnu.org/licenses/>.\n  -->\n\n<template>\n  <div>\n    <Alert :message=\"errorMessage\" type=\"danger\"/>\n    <Alert :message=\"successMessage\" type=\"success\"/>\n    <SplitPills :transactions=\"transactions\"/>\n\n    <div class=\"tab-content\">\n      <SplitForm\n          v-for=\"(transaction, index) in this.transactions\"\n          v-bind:key=\"index\"\n          :count=\"transactions.length\"\n          :transaction=\"transaction\"\n          :allowed-opposing-types=\"allowedOpposingTypes\"\n          :custom-fields=\"customFields\"\n          :date=\"date\"\n          :time=\"time\"\n          :index=\"index\"\n          :transaction-type=\"transactionType\"\n          :destination-allowed-types=\"destinationAllowedTypes\"\n          :source-allowed-types=\"sourceAllowedTypes\"\n          :allow-switch=\"false\"\n          :submitted-transaction=\"submittedTransaction\"\n          v-on:uploaded-attachments=\"uploadedAttachment($event)\"\n          v-on:set-marker-location=\"storeLocation($event)\"\n          v-on:set-account=\"storeAccountValue($event)\"\n          v-on:set-date=\"storeDate($event)\"\n          v-on:set-time=\"storeTime($event)\"\n          v-on:set-field=\"storeField($event)\"\n          v-on:remove-transaction=\"removeTransaction($event)\"\n          v-on:selected-attachments=\"selectedAttachments($event)\"\n      />\n    </div>\n\n    <!-- bottom buttons etc -->\n    <div class=\"row\">\n      <!-- group title -->\n      <div class=\"col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12\">\n        <div v-if=\"transactions.length > 1\" class=\"card\">\n          <div class=\"card-body\">\n            <div class=\"row\">\n              <div class=\"col\">\n                <TransactionGroupTitle v-model=\"this.groupTitle\" :errors=\"this.groupTitleErrors\" v-on:set-group-title=\"storeGroupTitle($event)\"/>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12\">\n        <!-- buttons -->\n        <div class=\"card\">\n          <div class=\"card-body\">\n            <div class=\"row\">\n              <div class=\"col\">\n                <div class=\"text-xs d-none d-lg-block d-xl-block\">\n                  &nbsp;\n                </div>\n                <button class=\"btn btn-outline-primary btn-block\" @click=\"addTransaction\"><i class=\"far fa-clone\"></i> {{ $t('firefly.add_another_split') }}\n                </button>\n              </div>\n              <div class=\"col\">\n                <div class=\"text-xs d-none d-lg-block d-xl-block\">\n                  &nbsp;\n                </div>\n                <button :disabled=\"!enableSubmit\" class=\"btn btn-info btn-block\" @click=\"submitTransaction\">\n                  <span v-if=\"enableSubmit\"><i class=\"far fa-save\"></i> {{ $t('firefly.update_transaction') }}</span>\n                  <span v-if=\"!enableSubmit\"><i class=\"fas fa-spinner fa-spin\"></i></span>\n                </button>\n              </div>\n            </div>\n            <div class=\"row\">\n              <div class=\"col\">\n                &nbsp;\n              </div>\n              <div class=\"col\">\n                <div class=\"form-check\">\n                  <input id=\"createAnother\" v-model=\"createAnother\" class=\"form-check-input\" type=\"checkbox\">\n                  <label class=\"form-check-label\" for=\"createAnother\">\n                    <span class=\"small\">{{ $t('firefly.after_update_create_another') }}</span>\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nconst lodashClonedeep = require('lodash.clonedeep');\nimport Alert from '../partials/Alert';\nimport SplitPills from \"./SplitPills\";\nimport SplitForm from \"./SplitForm\";\nimport TransactionGroupTitle from \"./TransactionGroupTitle\";\nimport {getDefaultErrors, getDefaultTransaction, toW3CString} from '../shared/transactions';\n\nexport default {\n  name: \"Edit\",\n  created() {\n    let parts = window.location.pathname.split('/');\n    this.groupId = parseInt(parts[parts.length - 1]);\n\n    this.getTransactionGroup();\n    this.getAllowedOpposingTypes();\n    this.getCustomFields();\n  },\n  data() {\n    return {\n      successMessage: '',\n      errorMessage: '',\n\n      // transaction props\n      transactions: [],\n      originalTransactions: [],\n      groupTitle: '',\n      originalGroupTitle: '',\n      transactionType: 'any',\n      groupId: 0,\n\n      // errors in the group title:\n      groupTitleErrors: [],\n\n      // which custom fields to show\n      customFields: {},\n\n      // group ID + title once submitted:\n      returnedGroupId: 0,\n      returnedGroupTitle: '',\n\n      // date and time of the transaction,\n      date: new Date,\n      time: new Date,\n      originalDate: new Date,\n      originalTime: new Date,\n\n      // things the process is done working on (3 phases):\n      submittedTransaction: false,\n      submittedLinks: false,\n      submittedAttachments: false,\n\n      // meta data for accounts\n      allowedOpposingTypes: {},\n      destinationAllowedTypes: [],\n      sourceAllowedTypes: [],\n\n      // states for the form (makes sense right)\n      enableSubmit: true,\n      createAnother: false,\n      resetFormAfter: false,\n\n    }\n  },\n  components: {\n    Alert,\n    SplitPills,\n    SplitForm,\n    TransactionGroupTitle\n  },\n  methods: {\n    /**\n     * Grap transaction group from URL and submit GET.\n     */\n    getTransactionGroup: function () {\n      axios.get('./api/v1/transactions/' + this.groupId)\n          .then(response => {\n                  this.parseTransactionGroup(response.data);\n                }\n          ).catch(error => {\n        // console.log('I failed :(');\n        // console.log(error);\n      });\n    },\n    /**\n     * Parse transaction group. Title is easy, transactions have their own method.\n     * @param response\n     */\n    parseTransactionGroup: function (response) {\n      // console.log('Will now parse');\n      // console.log(response);\n      let attributes = response.data.attributes;\n      let transactions = attributes.transactions.reverse();\n      this.groupTitle = attributes.group_title;\n      this.originalGroupTitle = attributes.group_title;\n\n      for (let i in transactions) {\n        if (transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          let result = this.parseTransaction(parseInt(i), transactions[i]);\n          this.transactions.push(result);\n          this.originalTransactions.push(lodashClonedeep(result));\n          // pick up the links of this transaction:\n          this.parseLinks(parseInt(result.transaction_journal_id), parseInt(i));\n        }\n      }\n    },\n    /**\n     * Parse a single transaction.\n     *\n     * @param index\n     * @param array\n     */\n    parseTransaction: function (index, array) {\n      //console.log('index: ' + index);\n      if (0 === index) {\n        this.transactionType = array.type.charAt(0).toUpperCase() + array.type.slice(1);\n        this.sourceAllowedTypes = [array.source_type];\n        this.destinationAllowedTypes = [array.destination_type];\n        this.date = new Date(array.date);\n        this.time = new Date(array.date);\n        this.originalDate = new Date(array.date);\n        this.originalTime = new Date(array.date);\n      }\n      let result = getDefaultTransaction();\n      // parsing here:\n      result.description = array.description;\n      result.transaction_journal_id = parseInt(array.transaction_journal_id);\n      // accounts:\n      result.source_account_id = array.source_id;\n      result.source_account_name = array.source_name;\n      result.source_account_type = array.source_type;\n\n      result.destination_account_id = array.destination_id;\n      result.destination_account_name = array.destination_name;\n      result.destination_account_type = array.destination_type;\n\n      // amount:\n      result.amount = array.amount;\n      result.currency_id = array.currency_id;\n      result.foreign_amount = array.foreign_amount;\n      result.foreign_currency_id = array.foreign_currency_id;\n\n      // meta data\n      result.category = array.category_name;\n      result.budget_id = array.budget_id;\n      result.bill_id = array.bill_id ?? 0;\n\n      result.tags = array.tags;\n\n      // optional date fields (6x):\n      result.interest_date = array.interest_date ? array.interest_date.substr(0, 10) : '';\n      result.book_date = array.book_date ? array.book_date.substr(0, 10) : '';\n      result.process_date = array.process_date ? array.process_date.substr(0, 10) : '';\n      result.due_date = array.due_date ? array.due_date.substr(0, 10) : '';\n      result.payment_date = array.payment_date ? array.payment_date.substr(0, 10) : '';\n      result.invoice_date = array.invoice_date ? array.invoice_date.substr(0, 10) : '';\n\n      // optional other fields:\n      result.internal_reference = array.internal_reference;\n      result.external_url = array.external_uri;\n      result.external_id = array.external_id;\n      result.notes = array.notes;\n      // location:\n      result.location = {\n        zoom_level: array.zoom_level,\n        longitude: array.longitude,\n        latitude: array.latitude,\n      };\n      result.zoom_level = array.zoom_level;\n      result.longitude = array.longitude;\n      result.latitude = array.latitude;\n\n      // error handling\n      result.errors = getDefaultErrors();\n      return result;\n    },\n    /**\n     * Get the links of this transaction group from the API.\n     */\n    parseLinks: function (journalId, index) {\n      axios.get('./api/v1/transaction-journals/' + journalId + '/links')\n          .then(response => {\n            let links = response.data.data;\n            for (let i in links) {\n              if (links.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n                this.parseLink(links[i], journalId, index);\n              }\n            }\n          });\n    },\n\n    /**\n     * Process individual link from the API.\n     */\n    parseLink: function (link, journalId, index) {\n      let promises = [];\n      let opposingId = parseInt(link.attributes.inward_id);\n      let linkDirection = 'inward';\n      if (opposingId === journalId) {\n        opposingId = parseInt(link.attributes.outward_id);\n        linkDirection = 'outward';\n      }\n      // add meta data to promise context.\n      promises.push(new Promise((resolve) => {\n        resolve(\n            {\n              link: link,\n              journalId: journalId,\n              opposingId: opposingId,\n              index: index,\n              direction: linkDirection\n            }\n        );\n      }));\n\n      // get stuff from the API:\n      promises.push(axios.get('./api/v1/transaction-journals/' + opposingId));\n      promises.push(axios.get('./api/v1/transaction_links/' + link.attributes.link_type_id));\n\n      Promise.all(promises).then(responses => {\n        let journals = responses[1].data.data.attributes.transactions;\n        let opposingId = responses[0].opposingId;\n        let journal = {};\n        // loop over journals to get the correct one:\n        for (let i in journals) {\n          if (journals.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n            if (journals[i].transaction_journal_id === opposingId) {\n              journal = journals[i];\n            }\n          }\n        }\n        let index = responses[0].index;\n        let direction = responses[0].direction;\n        let linkTypeId = responses[2].data.data.id;\n        let object = {\n          id: link.id,\n          link_type_id: linkTypeId + '-' + direction,\n          transaction_group_id: responses[1].data.data.id,\n          transaction_journal_id: journal.transaction_journal_id,\n          description: journal.description,\n          type: journal.type,\n          currency_code: journal.currency_code,\n          amount: journal.amount\n        };\n        this.transactions[index].links.push(object);\n        this.originalTransactions[index].links.push(object);\n      });\n    },\n    /**\n     * TODO same method as Create\n     * Get API value.\n     */\n    getAllowedOpposingTypes: function () {\n      axios.get('./api/v1/configuration/firefly.allowed_opposing_types')\n          .then(response => {\n            this.allowedOpposingTypes = response.data.data.value;\n            // console.log('Set allowedOpposingTypes');\n          });\n    },\n    /**\n     * Get API value.\n     */\n    getCustomFields: function () {\n      axios.get('./api/v1/preferences/transaction_journal_optional_fields').then(response => {\n        this.customFields = response.data.data.attributes.data;\n      });\n    },\n    uploadedAttachment: function (payload) {\n      console.log('event: uploadedAttachment');\n      console.log(payload);\n    },\n    storeLocation: function (payload) {\n      this.transactions[payload.index].zoom_level = payload.zoomLevel;\n      this.transactions[payload.index].longitude = payload.lng;\n      this.transactions[payload.index].latitude = payload.lat;\n    },\n    storeAccountValue: function (payload) {\n      let direction = payload.direction;\n      let index = payload.index;\n      this.transactions[index][direction + '_account_id'] = payload.id;\n      this.transactions[index][direction + '_account_type'] = payload.type;\n      this.transactions[index][direction + '_account_name'] = payload.name;\n    },\n    storeDate: function (payload) {\n      // console.log('event: storeDate');\n      // console.log(payload);\n      this.date = payload.date;\n    },\n    storeTime: function (payload) {\n      this.time = payload.time;\n      // console.log('event: storeTime');\n      // console.log(payload);\n    },\n    storeField: function (payload) {\n      let field = payload.field;\n      if ('category' === field) {\n        field = 'category_name';\n      }\n      // console.log('event: storeField(' + field + ')');\n      this.transactions[payload.index][field] = payload.value;\n\n    },\n    removeTransaction: function (payload) {\n      this.transactions.splice(payload.index, 1);\n      // this kills the original transactions.\n      this.originalTransactions = [];\n    },\n    storeGroupTitle: function (payload) {\n      this.groupTitle = payload;\n    },\n    selectedAttachments: function (payload) {\n      for (let i in this.transactions) {\n        if (this.transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          if (parseInt(this.transactions[i].transaction_journal_id) === parseInt(payload)) {\n            // console.log('selectedAttachments ' + payload);\n            this.transactions[i].selectedAttachments = true;\n          }\n        }\n      }\n    },\n    addTransaction: function () {\n      let newTransaction = getDefaultTransaction();\n      newTransaction.errors = getDefaultErrors();\n      this.transactions.push(newTransaction);\n    },\n    submitTransaction: function () {\n      let submission = {transactions: []};\n      let shouldSubmit = false;\n      let shouldLinks = false;\n      let shouldUpload = false;\n      if (this.groupTitle !== this.originalGroupTitle) {\n        submission.group_title = this.groupTitle;\n        shouldSubmit = true;\n      }\n      let transactionCount = this.originalTransactions.length;\n      for (let i in this.transactions) {\n        if (this.transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          // original transaction present?\n          let currentTransaction = this.transactions[i];\n          let originalTransaction = this.originalTransactions.hasOwnProperty(i) ? this.originalTransactions[i] : {};\n\n          let diff = {};\n\n          // compare basic fields:\n          let basicFields = [\n            'description',\n            'source_account_id', 'source_account_name',\n            'destination_account_id', 'destination_account_name',\n            'amount', 'foreign_amount', 'foreign_currency_id',\n            'category_name', 'budget_id', 'bill_id',\n            'interest_date', 'book_date', 'due_date', 'payment_date', 'invoice_date',\n            'external_url', 'internal_reference', 'external_id', 'notes',\n            'zoom_level', 'longitude', 'latitude'\n          ];\n\n          for (let ii in basicFields) {\n            if (basicFields.hasOwnProperty(ii) && /^0$|^[1-9]\\d*$/.test(ii) && ii <= 4294967294) {\n              let fieldName = basicFields[ii];\n              if (currentTransaction[fieldName] !== originalTransaction[fieldName]) {\n                // console.log('Index ' + i + ': Field ' + fieldName + ' updated (\"' + originalTransaction[fieldName] + '\" > \"' + currentTransaction[fieldName] + '\")');\n                // console.log(originalTransaction[fieldName]);\n                // console.log(currentTransaction[fieldName]);\n                diff[fieldName] = currentTransaction[fieldName];\n                shouldSubmit = true;\n              }\n            }\n          }\n          if (0 !== currentTransaction.piggy_bank_id) {\n            diff.piggy_bank_id = currentTransaction.piggy_bank_id;\n            shouldSubmit = true;\n          }\n          if (JSON.stringify(currentTransaction.tags) !== JSON.stringify(originalTransaction.tags)) {\n            // console.log('tags are different');\n            // console.log(currentTransaction.tags);\n            // console.log(originalTransaction.tags);\n            diff.tags = currentTransaction.tags;\n            shouldSubmit = true;\n          }\n\n          // compare links:\n          let newLinks = this.compareLinks(currentTransaction.links);\n          let originalLinks = this.compareLinks(originalTransaction.links);\n          // console.log('links are?');\n          // console.log(newLinks);\n          // console.log(originalLinks);\n          if (newLinks !== originalLinks) {\n            // console.log('links are different!');\n            // console.log(newLinks);\n            // console.log(originalLinks);\n            shouldLinks = true;\n          }\n          // this.transactions[i].selectedAttachments\n          // console.log(typeof currentTransaction.selectedAttachments);\n          // console.log(currentTransaction.selectedAttachments);\n          if (typeof currentTransaction.selectedAttachments !== 'undefined' && true === currentTransaction.selectedAttachments) {\n            // must upload!\n            shouldUpload = true;\n          }\n\n          let dateStr = 'invalid';\n          if (\n              this.date.toISOString() !== this.originalDate.toISOString() ||\n              this.time.toISOString() !== this.originalTime.toISOString()\n          ) {\n            // set date and time!\n            shouldSubmit = true;\n            let theDate = this.date;\n            // update time in date object.\n            theDate.setHours(this.time.getHours());\n            theDate.setMinutes(this.time.getMinutes());\n            theDate.setSeconds(this.time.getSeconds());\n            dateStr = toW3CString(theDate);\n            submission.date = dateStr;\n          }\n          if (Object.keys(diff).length === 0 && transactionCount > 1) {\n            diff.transaction_journal_id = originalTransaction.transaction_journal_id;\n            submission.transactions.push(lodashClonedeep(diff));\n            shouldSubmit = true;\n          } else if (Object.keys(diff).length !== 0) {\n            diff.transaction_journal_id = originalTransaction.transaction_journal_id;\n            submission.transactions.push(lodashClonedeep(diff));\n            shouldSubmit = true;\n          }\n        }\n      }\n\n      console.log('submitTransaction');\n      console.log(shouldUpload);\n      console.log(shouldLinks);\n      console.log(shouldSubmit);\n      if (shouldSubmit) {\n        this.submitUpdate(submission, shouldLinks, shouldUpload);\n      }\n      if (!shouldSubmit && shouldLinks) {\n        this.submitTransactionLinks();\n      }\n\n      //console.log(submission);\n    },\n    compareLinks: function (array) {\n      let compare = [];\n      for (let i in array) {\n        if (array.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          compare.push(\n              {\n                amount: array[i].amount,\n                currency_code: array[i].currency_code,\n                description: array[i].description,\n                link_type_id: array[i].link_type_id,\n                transaction_group_id: array[i].transaction_group_id,\n                type: array[i].type,\n              }\n          );\n        }\n      }\n      // console.log('compareLinks');\n      // console.log(compare);\n      return JSON.stringify(compare);\n    },\n    submitUpdate: function (submission, shouldLinks, shouldUpload) {\n      console.log('submitUpdate');\n      const url = './api/v1/transactions/' + this.groupId;\n      console.log(submission);\n      axios.put(url, submission)\n          .then(response => {\n                  console.log('Response is OK!');\n                  // report the transaction is submitted.\n                  this.submittedTransaction = true;\n\n                  // submit links and attachments (can only be done when the transaction is created)\n                  if (shouldLinks) {\n                    console.log('Need to update links.');\n                    this.submitTransactionLinks();\n                  }\n                  if (!shouldLinks) {\n                    console.log('No need to update links.');\n                  }\n                  // this.submitAttachments(data, response);\n                  //\n                  // // meanwhile, store the ID and the title in some easy to access variables.\n                  // this.returnedGroupId = parseInt(response.data.data.id);\n                  // this.returnedGroupTitle = null === response.data.data.attributes.group_title ? response.data.data.attributes.transactions[0].description : response.data.data.attributes.group_title;\n                }\n          )\n          .catch(error => {\n                   console.log('error :(');\n                   console.log(error.response.data);\n                   // oh noes Firefly III has something to bitch about.\n                   this.enableSubmit = true;\n                   // report the transaction is submitted.\n                   this.submittedTransaction = true;\n                   // // also report attachments and links are submitted:\n                   this.submittedAttachments = true;\n                   this.submittedLinks = true;\n                   //\n                   // but report an error because error:\n                   this.inError = true;\n                   this.parseErrors(error.response.data);\n                 }\n          );\n    },\n    parseErrors: function (errors) {\n      for (let i in this.transactions) {\n        if (this.transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          this.resetErrors({index: i});\n        }\n      }\n      this.successMessage = '';\n      this.errorMessage = this.$t('firefly.errors_submission');\n      if (typeof errors.errors === 'undefined') {\n        this.successMessage = '';\n        this.errorMessage = errors.message;\n      }\n\n      let payload;\n      let transactionIndex;\n      let fieldName;\n\n      // fairly basic way of exploding the error array.\n      for (const key in errors.errors) {\n        // console.log('Error index: \"' + key + '\"');\n        if (errors.errors.hasOwnProperty(key)) {\n          if (key === 'group_title') {\n            this.groupTitleErrors = errors.errors[key];\n            continue;\n          }\n          if (key !== 'group_title') {\n            // lol dumbest way to explode \"transactions.0.something\" ever.\n            transactionIndex = parseInt(key.split('.')[1]);\n\n            fieldName = key.split('.')[2];\n\n            // set error in this object thing.\n            // console.log('The errors in key \"' + key + '\" are');\n            // console.log(errors.errors[key]);\n            switch (fieldName) {\n              case 'amount':\n              case 'description':\n              case 'date':\n              case 'tags':\n                payload = {index: transactionIndex, field: fieldName, errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'budget_id':\n                payload = {index: transactionIndex, field: 'budget', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'bill_id':\n                payload = {index: transactionIndex, field: 'bill', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'piggy_bank_id':\n                payload = {index: transactionIndex, field: 'piggy_bank', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'category_name':\n                payload = {index: transactionIndex, field: 'category', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'source_name':\n              case 'source_id':\n                payload = {index: transactionIndex, field: 'source', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'destination_name':\n              case 'destination_id':\n                payload = {index: transactionIndex, field: 'destination', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n              case 'foreign_amount':\n              case 'foreign_currency':\n                payload = {index: transactionIndex, field: 'foreign_amount', errors: errors.errors[key]};\n                this.setTransactionError(payload);\n                break;\n            }\n          }\n          // unique some things\n          if (typeof this.transactions[transactionIndex] !== 'undefined') {\n            //this.transactions[transactionIndex].errors.source = Array.from(new Set(this.transactions[transactionIndex].errors.source));\n            //this.transactions[transactionIndex].errors.destination = Array.from(new Set(this.transactions[transactionIndex].errors.destination));\n          }\n\n        }\n      }\n    },\n    setTransactionError: function (payload) {\n      this.transactions[payload.index].errors[payload.field] = payload.errors;\n    },\n    resetErrors(payload) {\n      this.transactions[payload.index].errors = lodashClonedeep(getDefaultErrors());\n    },\n\n    deleteOriginalLinks: function (transaction) {\n      console.log(transaction.links);\n      for (let i in transaction.links) {\n        if (transaction.links.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          let current = transaction.links[i];\n          let url = '/api/v1/transaction_links/' + current.id;\n          axios.delete(url).then(response => {\n            // TODO response\n          });\n        }\n      }\n    },\n\n    /**\n     * Submit transaction links.\n     * TODO same method as CREATE\n     */\n    submitTransactionLinks() {\n      let total = 0;\n      let promises = [];\n\n      console.log('submitTransactionLinks()');\n      for (let i in this.transactions) {\n        if (this.transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n          // original transaction present?\n          let currentTransaction = this.transactions[i];\n          let originalTransaction = this.originalTransactions.hasOwnProperty(i) ? this.originalTransactions[i] : {};\n          // compare links:\n          let newLinks = this.compareLinks(currentTransaction.links);\n          let originalLinks = this.compareLinks(originalTransaction.links);\n          if (newLinks !== originalLinks) {\n            if ('[]' !== originalLinks) {\n              this.deleteOriginalLinks(originalTransaction);\n            }\n\n            console.log('links are different!');\n            // console.log(newLinks);\n            // console.log(originalLinks);\n            for (let ii in currentTransaction.links) {\n              if (currentTransaction.links.hasOwnProperty(ii) && /^0$|^[1-9]\\d*$/.test(ii) && ii <= 4294967294) {\n                let currentLink = currentTransaction.links[ii];\n                let linkObject = {\n                  inward_id: currentTransaction.transaction_journal_id,\n                  outward_id: currentTransaction.transaction_journal_id,\n                  link_type_id: 'something'\n                };\n\n                let parts = currentLink.link_type_id.split('-');\n                linkObject.link_type_id = parts[0];\n                if ('inward' === parts[1]) {\n                  linkObject.inward_id = currentLink.transaction_journal_id;\n                }\n                if ('outward' === parts[1]) {\n                  linkObject.outward_id = currentLink.transaction_journal_id;\n                }\n\n                console.log(linkObject);\n                total++;\n                // submit transaction link:\n                promises.push(axios.post('./api/v1/transaction_links', linkObject).then(response => {\n                  // TODO error handling.\n                }));\n              }\n            }\n\n            // shouldLinks = true;\n          }\n\n        }\n      }\n\n\n      return;\n      let result = response.data.data.attributes.transactions;\n\n      // for (let i in data.transactions) {\n      //   if (data.transactions.hasOwnProperty(i) && /^0$|^[1-9]\\d*$/.test(i) && i <= 4294967294) {\n      //     let submitted = data.transactions[i];\n      //     if (result.hasOwnProperty(i)) {\n      //       // found matching created transaction.\n      //       let received = result[i];\n      //       // grab ID from received, loop \"submitted\" transaction links\n      //       for (let ii in submitted.links) {\n      //         if (submitted.links.hasOwnProperty(ii) && /^0$|^[1-9]\\d*$/.test(ii) && ii <= 4294967294) {\n      //           let currentLink = submitted.links[ii];\n      //           total++;\n      //           if (0 === currentLink.outward_id) {\n      //             currentLink.outward_id = received.transaction_journal_id;\n      //           }\n      //           if (0 === currentLink.inward_id) {\n      //             currentLink.inward_id = received.transaction_journal_id;\n      //           }\n      //           // submit transaction link:\n      //           promises.push(axios.post('./api/v1/transaction_links', currentLink).then(response => {\n      //             // TODO error handling.\n      //           }));\n      //         }\n      //       }\n      //     }\n      //   }\n      // }\n      if (0 === total) {\n        this.submittedLinks = true;\n        return;\n      }\n      Promise.all(promises).then(function () {\n        this.submittedLinks = true;\n      });\n    },\n  }\n}\n</script>\n\n<style scoped>\n\n</style>","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Edit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Edit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Edit.vue?vue&type=template&id=248bc324&scoped=true&\"\nimport script from \"./Edit.vue?vue&type=script&lang=js&\"\nexport * from \"./Edit.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"248bc324\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('Alert',{attrs:{\"message\":_vm.errorMessage,\"type\":\"danger\"}}),_vm._v(\" \"),_c('Alert',{attrs:{\"message\":_vm.successMessage,\"type\":\"success\"}}),_vm._v(\" \"),_c('SplitPills',{attrs:{\"transactions\":_vm.transactions}}),_vm._v(\" \"),_c('div',{staticClass:\"tab-content\"},_vm._l((this.transactions),function(transaction,index){return _c('SplitForm',{key:index,attrs:{\"count\":_vm.transactions.length,\"transaction\":transaction,\"allowed-opposing-types\":_vm.allowedOpposingTypes,\"custom-fields\":_vm.customFields,\"date\":_vm.date,\"time\":_vm.time,\"index\":index,\"transaction-type\":_vm.transactionType,\"destination-allowed-types\":_vm.destinationAllowedTypes,\"source-allowed-types\":_vm.sourceAllowedTypes,\"allow-switch\":false,\"submitted-transaction\":_vm.submittedTransaction},on:{\"uploaded-attachments\":function($event){return _vm.uploadedAttachment($event)},\"set-marker-location\":function($event){return _vm.storeLocation($event)},\"set-account\":function($event){return _vm.storeAccountValue($event)},\"set-date\":function($event){return _vm.storeDate($event)},\"set-time\":function($event){return _vm.storeTime($event)},\"set-field\":function($event){return _vm.storeField($event)},\"remove-transaction\":function($event){return _vm.removeTransaction($event)},\"selected-attachments\":function($event){return _vm.selectedAttachments($event)}}})}),1),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12\"},[(_vm.transactions.length > 1)?_c('div',{staticClass:\"card\"},[_c('div',{staticClass:\"card-body\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_c('TransactionGroupTitle',{attrs:{\"errors\":this.groupTitleErrors},on:{\"set-group-title\":function($event){return _vm.storeGroupTitle($event)}},model:{value:(this.groupTitle),callback:function ($$v) {_vm.$set(this, \"groupTitle\", $$v)},expression:\"this.groupTitle\"}})],1)])])]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12\"},[_c('div',{staticClass:\"card\"},[_c('div',{staticClass:\"card-body\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_c('div',{staticClass:\"text-xs d-none d-lg-block d-xl-block\"},[_vm._v(\"\\n                 \\n              \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-outline-primary btn-block\",on:{\"click\":_vm.addTransaction}},[_c('i',{staticClass:\"far fa-clone\"}),_vm._v(\" \"+_vm._s(_vm.$t('firefly.add_another_split'))+\"\\n              \")])]),_vm._v(\" \"),_c('div',{staticClass:\"col\"},[_c('div',{staticClass:\"text-xs d-none d-lg-block d-xl-block\"},[_vm._v(\"\\n                 \\n              \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-info btn-block\",attrs:{\"disabled\":!_vm.enableSubmit},on:{\"click\":_vm.submitTransaction}},[(_vm.enableSubmit)?_c('span',[_c('i',{staticClass:\"far fa-save\"}),_vm._v(\" \"+_vm._s(_vm.$t('firefly.update_transaction')))]):_vm._e(),_vm._v(\" \"),(!_vm.enableSubmit)?_c('span',[_c('i',{staticClass:\"fas fa-spinner fa-spin\"})]):_vm._e()])])]),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_vm._v(\"\\n               \\n            \")]),_vm._v(\" \"),_c('div',{staticClass:\"col\"},[_c('div',{staticClass:\"form-check\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.createAnother),expression:\"createAnother\"}],staticClass:\"form-check-input\",attrs:{\"id\":\"createAnother\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.createAnother)?_vm._i(_vm.createAnother,null)>-1:(_vm.createAnother)},on:{\"change\":function($event){var $$a=_vm.createAnother,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.createAnother=$$a.concat([$$v]))}else{$$i>-1&&(_vm.createAnother=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.createAnother=$$c}}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"createAnother\"}},[_c('span',{staticClass:\"small\"},[_vm._v(_vm._s(_vm.$t('firefly.after_update_create_another')))])])])])])])])])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/*\n * edit.js\n * Copyright (c) 2020 james@firefly-iii.org\n *\n * This file is part of Firefly III (https://github.com/firefly-iii).\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport store from \"../../components/store\";\nimport Edit from \"../../components/transactions/Edit\";\nimport Vue from \"vue\";\n\nrequire('../../bootstrap');\n\nVue.config.productionTip = false;\n// i18n\nlet i18n = require('../../i18n');\n\nlet props = {};\nnew Vue({\n            i18n,\n            store,\n            render(createElement) {\n                return createElement(Edit, {props: props});\n            },\n            beforeCreate() {\n                this.$store.commit('initialiseStore');\n                this.$store.dispatch('updateCurrencyPreference');\n            },\n        }).$mount('#transactions_edit');\n"],"sourceRoot":""}