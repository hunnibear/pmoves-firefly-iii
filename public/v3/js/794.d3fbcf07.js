"use strict";(globalThis["webpackChunkfirefly_iii"]=globalThis["webpackChunkfirefly_iii"]||[]).push([[794],{794:(t,e,n)=>{n.r(e),n.d(e,{default:()=>M});var i=n(9835),a=n(6970);const s={class:"q-mr-sm"},r=["title"],o=(0,i.Uk)(": "),u=["title"],d={key:0},l=(0,i._)("br",null,null,-1),p=["title"],m=["title"],c={key:0};function h(t,e,n,h,g,f){const v=(0,i.up)("q-item-label"),_=(0,i.up)("q-item-section"),w=(0,i.up)("q-item"),y=(0,i.up)("q-separator"),A=(0,i.up)("q-circular-progress"),k=(0,i.up)("q-card-section"),b=(0,i.up)("q-card");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(b,{bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i._)("strong",null,(0,a.zw)(t.$t("firefly.bills_to_pay")),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(y),(0,i.Wm)(k,{horizontal:""},{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(A,{value:f.percentage,size:"50px",thickness:.22,color:"positive","track-color":"negative"},null,8,["value","thickness"])])),_:1}),(0,i.Wm)(y,{vertical:""}),0===g.unpaid.length&&0===g.paid.length?((0,i.wg)(),(0,i.j4)(k,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.$t("firefly.no_bill")),1)])),_:1})):(0,i.kq)("",!0),g.unpaid.length>0||g.paid.length>0?((0,i.wg)(),(0,i.j4)(k,{key:1},{default:(0,i.w5)((()=>[(0,i._)("span",{title:f.formatAmount(this.currency,this.unpaidAmount)},(0,a.zw)(t.$t("firefly.bills_to_pay")),9,r),o,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.unpaid,((t,e)=>((0,i.wg)(),(0,i.iD)("span",null,[(0,i._)("span",{title:f.formatAmount(t.native_code,t.native_sum)},[(0,i.Uk)((0,a.zw)(f.formatAmount(t.code,t.sum)),1),e+1!==g.unpaid.length?((0,i.wg)(),(0,i.iD)("span",d," + ")):(0,i.kq)("",!0)],8,u)])))),256)),l,g.paid.length>0?((0,i.wg)(),(0,i.iD)("span",{key:0,title:f.formatAmount(this.currency,this.paidAmount)},(0,a.zw)(t.$t("firefly.bills_paid"))+":",9,p)):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.paid,((t,e)=>((0,i.wg)(),(0,i.iD)("span",null,[(0,i._)("span",{title:f.formatAmount(t.native_code,t.native_sum)},(0,a.zw)(f.formatAmount(t.code,t.sum)),9,m),e+1!==g.paid.length?((0,i.wg)(),(0,i.iD)("span",c," + ")):(0,i.kq)("",!0)])))),256))])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1})])}var g=n(3555),f=n(1569),v=n(8898);class _{unpaid(t,e){let n="api/v2/bills/sum/unpaid",i=(0,v.Z)(t,"y-MM-dd"),a=(0,v.Z)(e,"y-MM-dd");return f.api.get(n,{params:{start:i,end:a}})}paid(t,e){let n="api/v2/bills/sum/paid",i=(0,v.Z)(t,"y-MM-dd"),a=(0,v.Z)(e,"y-MM-dd");return f.api.get(n,{params:{start:i,end:a}})}}const w={data(){return{store:null,unpaid:[],paid:[],currency:"EUR",unpaidAmount:0,paidAmount:0}},name:"BillInsightBox",computed:{percentage:function(){if(0===this.unpaidAmount)return 100;if(0===this.paidAmount)return 0;const t=this.paidAmount+this.unpaidAmount,e=this.paidAmount/t*100;return e>100?100:e}},mounted(){this.store=(0,g.S)(),this.store.$onAction((({name:t,$store:e,args:n,after:i,onError:a})=>{i((e=>{"setRange"===t&&this.triggerUpdate()}))})),this.triggerUpdate()},methods:{triggerUpdate:function(){if(null!==this.store.getRange.start&&null!==this.store.getRange.end){this.unpaid=[];const t=new Date(this.store.getRange.start),e=new Date(this.store.getRange.end),n=new _;this.currency=this.store.getCurrencyCode,n.unpaid(t,e).then((t=>this.parseUnpaidResponse(t.data))),n.paid(t,e).then((t=>this.parsePaidResponse(t.data)))}},formatAmount:function(t,e){return Intl.NumberFormat(this.store.getLocale,{style:"currency",currency:t}).format(e)},parseUnpaidResponse:function(t){for(let e in t)if(t.hasOwnProperty(e)){const n=t[e],i=n.converted&&n.native_id!==n.id&&0!==parseFloat(n.native_sum);this.unpaid.push({sum:n.sum,code:n.code,native_sum:n.converted?n.native_sum:n.sum,native_code:n.converted?n.native_code:n.code,native:i}),n.converted&&(i||n.native_id===n.id)&&(this.unpaidAmount=this.unpaidAmount+parseFloat(n.native_sum)),n.converted||(this.unpaidAmount=this.unpaidAmount+parseFloat(n.sum))}},parsePaidResponse:function(t){for(let e in t)if(t.hasOwnProperty(e)){const n=t[e],i=n.converted&&n.native_id!==n.id&&0!==parseFloat(n.native_sum);this.paid.push({sum:n.sum,code:n.code,native_sum:n.converted?n.native_sum:n.sum,native_code:n.converted?n.native_code:n.code,native:i}),n.converted&&(i||n.native_id===n.id)&&(this.paidAmount=this.paidAmount+-1*parseFloat(n.native_sum)),n.converted||(this.paidAmount=this.paidAmount+-1*parseFloat(n.sum))}}}};var y=n(1639),A=n(4458),k=n(490),b=n(1233),q=n(3115),Z=n(926),D=n(3190),R=n(3302),U=n(9984),W=n.n(U);const z=(0,y.Z)(w,[["render",h]]),M=z;W()(w,"components",{QCard:A.Z,QItem:k.Z,QItemSection:b.Z,QItemLabel:q.Z,QSeparator:Z.Z,QCardSection:D.Z,QCircularProgress:R.Z})}}]);