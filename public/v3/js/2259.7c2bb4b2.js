"use strict";(self["webpackChunkfirefly_iii"]=self["webpackChunkfirefly_iii"]||[]).push([[2259],{2259:(t,e,a)=>{a.r(e),a.d(e,{default:()=>$});var i=a(3673),n=a(2323);const o=(0,i.Uk)("Edit"),s=(0,i.Uk)("Reconcile"),r=(0,i.Uk)("Delete");function l(t,e,a,l,p,u){const c=(0,i.up)("q-th"),d=(0,i.up)("q-tr"),g=(0,i.up)("router-link"),m=(0,i.up)("q-td"),h=(0,i.up)("q-item-label"),f=(0,i.up)("q-item-section"),w=(0,i.up)("q-item"),y=(0,i.up)("q-list"),b=(0,i.up)("q-btn-dropdown"),_=(0,i.up)("q-table"),k=(0,i.up)("q-fab-action"),q=(0,i.up)("q-fab"),W=(0,i.up)("q-page-sticky"),Z=(0,i.up)("q-page"),Q=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(Z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{title:t.$t("firefly."+this.type+"_accounts"),rows:p.rows,columns:p.columns,"row-key":"id",pagination:p.pagination,"onUpdate:pagination":e[0]||(e[0]=t=>p.pagination=t),loading:p.loading,class:"q-ma-md"},{header:(0,i.w5)((t=>[(0,i.Wm)(d,{props:t},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.cols,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.name,props:t},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,i.w5)((t=>[(0,i.Wm)(d,{props:t},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{key:"name",props:t},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{to:{name:"accounts.show",params:{id:t.row.id}},class:"text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.row.name),1)])),_:2},1032,["to"])])),_:2},1032,["props"]),(0,i.Wm)(m,{key:"iban",props:t},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(u.formatIban(t.row.iban)),1)])),_:2},1032,["props"]),(0,i.Wm)(m,{key:"menu",props:t},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{color:"primary",label:"Actions",size:"sm"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{clickable:"",to:{name:"accounts.edit",params:{id:t.row.id}}},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[o])),_:1})])),_:1})])),_:2},1032,["to"])),[[Q]]),"asset"===t.row.type?(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{key:0,clickable:"",to:{name:"accounts.reconcile",params:{id:t.row.id}}},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[s])),_:1})])),_:1})])),_:2},1032,["to"])),[[Q]]):(0,i.kq)("",!0),(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{clickable:"",onClick:e=>u.deleteAccount(t.row.id,t.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[r])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[Q]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["title","rows","columns","pagination","loading"]),(0,i.Wm)(W,{position:"bottom-right",offset:[18,18]},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{label:"Actions",square:"","vertical-actions-align":"right","label-position":"left",color:"green",icon:"fas fa-chevron-up",direction:"up"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{color:"primary",square:"",to:{name:"accounts.create",params:{type:"asset"}},icon:"fas fa-exchange-alt",label:"New asset account"},null,8,["to"])])),_:1})])),_:1})])),_:1})}a(5363);var p=a(3617),u=a(3349),c=a(2017);const d={name:"Index",watch:{$route(t){"accounts.index"===t.name&&(this.type=t.params.type,this.page=1,this.updateBreadcrumbs(),this.triggerUpdate())}},data(){return{rows:[],type:"asset",pagination:{sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:100},loading:!1,columns:[{name:"name",label:"Name",field:"name",align:"left"},{name:"iban",label:"IBAN",field:"iban",align:"left"},{name:"menu",label:" ",field:"menu",align:"right"}]}},computed:{...(0,p.Se)("fireflyiii",["getRange","getCacheKey","getListPageSize"])},created(){this.pagination.rowsPerPage=this.getListPageSize},mounted(){if(this.type=this.$route.params.type,null===this.getRange.start||null===this.getRange.end){const t=(0,p.oR)();t.subscribe(((t,e)=>{"fireflyiii/setRange"===t.type&&(this.range={start:t.payload.start,end:t.payload.end},this.triggerUpdate())}))}null!==this.getRange.start&&null!==this.getRange.end&&(this.range={start:this.getRange.start,end:this.getRange.end},this.triggerUpdate())},methods:{deleteAccount:function(t,e){this.$q.dialog({title:"Confirm",message:'Do you want to delete account "'+e+'"? Any and all transactions linked to this account will ALSO be deleted.',cancel:!0,persistent:!0}).onOk((()=>{this.destroyAccount(t)}))},destroyAccount:function(t){new c.Z("accounts").destroy(t).then((()=>{this.rows=[],this.$store.dispatch("fireflyiii/refreshCacheKey").then((()=>{this.triggerUpdate()}))}))},updateBreadcrumbs:function(){this.$route.meta.pageTitle="firefly."+this.type+"_accounts",this.$route.meta.breadcrumbs=[{title:this.type+"_accounts"}]},onRequest:function(t){this.page=t.pagination.page,this.triggerUpdate()},formatIban:function(t){if(null===t)return"";let e=/[^a-zA-Z0-9]/g,a=/(.{4})(?!$)/g;return t.replace(e,"").toUpperCase().replace(a,"$1 ")},triggerUpdate:function(){if(this.rows=[],!0===this.loading)return;if(null===this.range.start||null===this.range.end)return;this.loading=!0;const t=new u.Z;this.rows=[],t.list(this.type,this.page,this.getCacheKey).then((t=>{this.pagination.rowsPerPage=t.data.meta.pagination.per_page,this.pagination.rowsNumber=t.data.meta.pagination.total,this.pagination.page=this.page;for(let e in t.data.data)if(t.data.data.hasOwnProperty(e)){let a=t.data.data[e],i={id:a.id,name:a.attributes.name,iban:a.attributes.iban,type:a.attributes.type};this.rows.push(i)}this.loading=!1})).catch((t=>{console.error("Error loading list"),console.error(t)}))}}};var g=a(4260),m=a(4379),h=a(4993),f=a(8186),w=a(2414),y=a(3884),b=a(2226),_=a(7011),k=a(3414),q=a(2035),W=a(2350),Z=a(4264),Q=a(9200),U=a(9975),P=a(677),A=a(7518),R=a.n(A);const C=(0,g.Z)(d,[["render",l]]),$=C;R()(d,"components",{QPage:m.Z,QTable:h.Z,QTr:f.Z,QTh:w.Z,QTd:y.Z,QBtnDropdown:b.Z,QList:_.Z,QItem:k.Z,QItemSection:q.Z,QItemLabel:W.Z,QPageSticky:Z.Z,QFab:Q.Z,QFabAction:U.Z}),R()(d,"directives",{ClosePopup:P.Z})}}]);