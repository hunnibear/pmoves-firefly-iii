import{a as l}from"./format-money-43e05102.js";import{a as p,G as f}from"./get-94678769.js";import{n as m,i as _}from"./vendor-fca45885.js";function x(r,n){let a=[];for(let o in r)if(r.hasOwnProperty(o)){const t=r[o];let e={};e.description=t.description,e.source_name=t.source_account.name,e.destination_name=t.destination_account.name,e.amount=t.amount,e.currency_code=t.currency_code,e.date=t.date,e.interest_date=t.interest_date,e.book_date=t.book_date,e.process_date=t.process_date,e.due_date=t.due_date,e.payment_date=t.payment_date,e.invoice_date=t.invoice_date,e.budget_id=t.budget_id,e.category_name=t.category_name,e.piggy_bank_id=t.piggy_bank_id,e.bill_id=t.bill_id,e.tags=t.tags,e.notes=t.notes,e.internal_reference=t.internal_reference,e.external_url=t.external_url,e.store_location=!1,t.hasLocation&&(e.store_location=!0,e.longitude=t.longitude.toString(),e.latitude=t.latitude.toString(),e.zoom_level=t.zoomLevel),typeof t.foreign_currency_code<"u"&&t.foreign_currency_code.toString()!==""&&(e.foreign_currency_code=t.foreign_currency_code,typeof t.foreign_amount<"u"&&t.foreign_amount.toString()!==""&&(e.foreign_amount=t.foreign_amount),(typeof t.foreign_amount>"u"||t.foreign_amount.toString()==="")&&(delete e.foreign_amount,delete e.foreign_currency_code)),typeof t.source_account.id<"u"&&t.source_account.id.toString()!==""&&(e.source_id=t.source_account.id),typeof t.destination_account.id<"u"&&t.destination_account.id.toString()!==""&&(e.destination_id=t.destination_account.id),e.type=n,a.push(e)}return a}let g=class{list(n){return l.get("/api/v2/currencies",{params:n})}};function C(){let r={page:1,limit:1337};return new g().list(r).then(a=>{let o={defaultCurrency:{},nativeCurrencies:[],foreignCurrencies:[],enabledCurrencies:[]};o.foreignCurrencies.push({id:0,name:"(no foreign currency)",code:"",default:!1,symbol:"",decimal_places:2});for(let t in a.data.data)if(a.data.data.hasOwnProperty(t)){let e=a.data.data[t];if(e.attributes.enabled){let c={id:e.id,name:e.attributes.name,code:e.attributes.code,default:e.attributes.default,symbol:e.attributes.symbol,decimal_places:e.attributes.decimal_places};c.default&&(o.defaultCurrency=c),o.enabledCurrencies.push(c),o.nativeCurrencies.push(c),o.foreignCurrencies.push(c)}}return o})}class y{list(n){return l.get("/api/v2/budgets",{params:n})}}function $(){let r={page:1,limit:1337};return new y().list(r).then(a=>{let o=[{id:0,name:"(no budget)"}];for(let t in a.data.data)if(a.data.data.hasOwnProperty(t)){let e=a.data.data[t],c={id:e.id,name:e.attributes.name};o.push(c)}return o})}function O(){let r={page:1,limit:1337};return new p().list(r).then(a=>{let o={0:{id:0,name:"(no group)",order:0,piggyBanks:[{id:0,name:"(no piggy bank)",order:0}]}};for(let t in a.data.data)if(a.data.data.hasOwnProperty(t)){let e=a.data.data[t],c=e.attributes.object_group_id??"0",i=e.attributes.object_group_title??"(no group)",u={id:e.id,name:e.attributes.name,order:e.attributes.order};o.hasOwnProperty(c)||(o[c]={id:c,name:i,order:e.attributes.object_group_order??0,piggyBanks:[]}),o[c].piggyBanks.push(u),o[c].piggyBanks.sort((d,s)=>d.order-s.order)}return Object.keys(o).sort().reduce((t,e)=>(t[e]=o[e],t),{})})}function j(){let r={page:1,limit:1337};return new f().list(r).then(a=>{let o={0:{id:0,name:"(no group)",order:0,subscriptions:[{id:0,name:"(no subscription)",order:0}]}};for(let t in a.data.data)if(a.data.data.hasOwnProperty(t)){let e=a.data.data[t],c=e.attributes.object_group_id??"0",i=e.attributes.object_group_title??"(no group)",u={id:e.id,name:e.attributes.name,order:e.attributes.order};o.hasOwnProperty(c)||(o[c]={id:c,name:i,order:e.attributes.object_group_order??0,subscriptions:[]}),o[c].subscriptions.push(u),o[c].subscriptions.sort((d,s)=>d.order-s.order)}return Object.keys(o).sort().reduce((t,e)=>(t[e]=o[e],t),{})})}function A(){return{description:"/api/v2/autocomplete/transaction-descriptions",account:"/api/v2/autocomplete/accounts",category:"/api/v2/autocomplete/categories",tag:"/api/v2/autocomplete/tags"}}function P(r){const n={server:r.serverUrl,serverParams:{},fetchOptions:{headers:{"X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content}},hiddenInput:!0,highlightTyped:!0,liveServer:!0};typeof r.filters<"u"&&r.filters.length>0&&(n.serverParams.types=r.filters),typeof r.onRenderItem<"u"&&r.onRenderItem!==null&&(n.onRenderItem=r.onRenderItem),r.valueField&&(n.valueField=r.valueField),r.labelField&&(n.labelField=r.labelField),r.onSelectItem&&(n.onSelectItem=r.onSelectItem),r.onChange&&(n.onChange=r.onChange),r.hiddenValue&&(n.hiddenValue=r.hiddenValue),m.init(r.selector,n)}function q(r,n){const a=parseInt(n._searchInput.attributes["data-index"].value);if(typeof r<"u"&&r.name){document.querySelector("#form")._x_dataStack[0].$data.entries[a].category_name=r.name;return}document.querySelector("#form")._x_dataStack[0].$data.entries[a].category_name=n._searchInput.value}function E(r,n){const a=parseInt(n._searchInput.attributes["data-index"].value);if(typeof r<"u"&&r.description){document.querySelector("#form")._x_dataStack[0].$data.entries[a].description=r.description;return}document.querySelector("#form")._x_dataStack[0].$data.entries[a].description=n._searchInput.value}function B(r,n){if(typeof r>"u"){const a=parseInt(n._searchInput.attributes["data-index"].value);if(document.querySelector("#form")._x_dataStack[0].$data.entries[a].destination_account.name===n._searchInput.value){console.warn('Ignore hallucinated destination account name change to "'+n._searchInput.value+'"');return}document.querySelector("#form")._x_dataStack[0].$data.entries[a].destination_account={name:n._searchInput.value,alpine_name:n._searchInput.value},document.querySelector("#form")._x_dataStack[0].changedDestinationAccount()}}function F(r,n){const a=parseInt(n._searchInput.attributes["data-index"].value);document.querySelector("#form")._x_dataStack[0].$data.entries[a].destination_account={id:r.id,name:r.name,alpine_name:r.name,type:r.type,currency_code:r.currency_code},document.querySelector("#form")._x_dataStack[0].changedDestinationAccount()}function G(r,n){if(typeof r>"u"){const a=parseInt(n._searchInput.attributes["data-index"].value);if(document.querySelector("#form")._x_dataStack[0].$data.entries[a].source_account.name===n._searchInput.value)return;document.querySelector("#form")._x_dataStack[0].$data.entries[a].source_account={name:n._searchInput.value,alpine_name:n._searchInput.value},document.querySelector("#form")._x_dataStack[0].changedSourceAccount()}}function R(r,n){const a=parseInt(n._searchInput.attributes["data-index"].value);document.querySelector("#form")._x_dataStack[0].$data.entries[a].source_account={id:r.id,name:r.name,alpine_name:r.name,type:r.type,currency_code:r.currency_code},document.querySelector("#form")._x_dataStack[0].changedSourceAccount()}class h{post(n,a,o){let t="/api/v1/attachments";return l.post(t,{filename:n,attachable_type:a,attachable_id:o})}upload(n,a){let o="./api/v1/attachments/"+n+"/upload";return axios.post(o,a)}}let b=function(r){let n=r.length,a=0,o=!1;for(const t in r)if(r.hasOwnProperty(t)&&/^0$|^[1-9]\d*$/.test(t)&&t<=4294967294&&o===!1){let e=new h;e.post(r[t].name,"TransactionJournal",r[t].journal).then(c=>{let i=parseInt(c.data.data.id);e.upload(i,r[t].content).then(u=>{if(a++,a===n){const d=new CustomEvent("upload-success",{some:"details"});document.dispatchEvent(d)}}).catch(u=>{console.error("Could not upload"),console.error(u),a++;const d=new CustomEvent("upload-failed",{error:u});document.dispatchEvent(d),o=!0})}).catch(c=>{console.error("Could not create upload."),console.error(c),a++;const i=new CustomEvent("upload-failed",{error:c});document.dispatchEvent(i),o=!0})}};function T(r,n){n=n.reverse();let a=[],o=0,t=[],e=document.querySelectorAll('input[name="attachments[]"]');for(const c in e)if(e.hasOwnProperty(c)&&/^0$|^[1-9]\d*$/.test(c)&&c<=4294967294)for(const i in e[c].files)e[c].files.hasOwnProperty(i)&&/^0$|^[1-9]\d*$/.test(i)&&i<=4294967294&&(a.push({journal:n[c].transaction_journal_id,file:e[c].files[i]}),o++);for(const c in a)a.hasOwnProperty(c)&&/^0$|^[1-9]\d*$/.test(c)&&c<=4294967294&&function(i,u){let d=new FileReader;d.onloadend=function(s){s.target.readyState===FileReader.DONE&&(t.push({name:a[u].file.name,journal:a[u].journal,content:new Blob([s.target.result])}),t.length===o&&b(t))},d.readAsArrayBuffer(i.file)}(a[c],c);return o}function v(r,n,a){let o=[];for(let t in a)a.hasOwnProperty(t)&&o.push(a[t].replace(r,n));return o}function D(r,n){let a,o,t;for(const e in r)if(r.hasOwnProperty(e)){if(e==="group_title"){console.error("Cannot handle error in group title.");continue}if(a=parseInt(e.split(".")[1]),o=e.split(".")[2],t=v(e,o,r[e]),!n.hasOwnProperty(a)){console.error("Cannot handle errors in index #"+a);continue}switch(o){case"currency_code":case"foreign_currency_code":case"category_name":case"piggy_bank_id":case"notes":case"internal_reference":case"external_url":case"latitude":case"longitude":case"zoom_level":case"interest_date":case"book_date":case"process_date":case"due_date":case"payment_date":case"invoice_date":case"amount":case"date":case"budget_id":case"bill_id":case"description":case"tags":n[a].errors[o]=t;break;case"source_name":case"source_id":n[a].errors.source_account=n[a].errors.source_account.concat(t);break;case"type":n[a].errors.source_account=n[a].errors.source_account.concat([_.t("validation.bad_type_source")]),n[a].errors.destination_account=n[a].errors.destination_account.concat([_.t("validation.bad_type_destination")]);break;case"destination_name":case"destination_id":n[a].errors.destination_account=n[a].errors.destination_account.concat(t);break;case"foreign_amount":case"foreign_currency_id":n[a].errors.foreign_amount=n[a].errors.foreign_amount.concat(t);break}typeof n[a]<"u"&&(n[a].errors.source_account=Array.from(new Set(n[a].errors.source_account)),n[a].errors.destination_account=Array.from(new Set(n[a].errors.destination_account)))}return console.log(n[0].errors),n}export{$ as a,O as b,j as c,T as d,P as e,G as f,R as g,B as h,F as i,A as j,q as k,C as l,E as m,x as p,D as s};
